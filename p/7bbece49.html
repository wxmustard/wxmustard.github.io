<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="Mr Wang's blog"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>云盘(docker)创建＋nginx - Mr Wang's blog</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="//s3.shu.aixinwu.org/wx_post_bg.jpg"><div class="post-title"><h1 class="title">云盘(docker)创建＋nginx</h1><ul class="meta"><li><i class="icon icon-author"></i>Mustard Wang</li><li><i class="icon icon-clock"></i>19 Minutes</li><li><i class="icon icon-calendar"></i>2017年10月13日</li></ul></div></div><div class="article-content" style="max-width:800px"><h2 id="docker创建云盘"><a href="#docker创建云盘" class="headerlink" title="docker创建云盘"></a>docker创建云盘</h2><ul>
<li><p>在拓展硬盘上建立目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /home/extspace</div><div class="line">sudo mkdir nextcloud</div><div class="line"><span class="built_in">cd</span> nextcloud</div><div class="line">sudo mkdir -p html/apps</div><div class="line">sudo mkdir -p html/config</div><div class="line">sudo mkdir -p html/data</div><div class="line">sudo mkdir db</div><div class="line">sudo mkdir -p html/custom_apps</div><div class="line">sudo mkdir -p html/themes</div></pre></td></tr></table></figure>
</li>
<li><p>回到用户主目录创建目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">mkdir nextcloud</div><div class="line">vim nextcloud/docker-compose.yml</div></pre></td></tr></table></figure>
<p><code>docker-compose.yml</code> 配置如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">'2'</span></div><div class="line"></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">  db:</span></div><div class="line"><span class="attr">    image:</span> <span class="string">mariadb</span></div><div class="line"><span class="attr">    restart:</span> <span class="string">always</span></div><div class="line"><span class="attr">    volumes:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">/home/extspace/nextcloud/db:/var/lib/mysql</span></div><div class="line"><span class="attr">    environment:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">MYSQL_ROOT_PASSWORD=centos</span></div><div class="line"><span class="bullet">      -</span> <span class="string">MYSQL_PASSWORD=centos</span></div><div class="line"><span class="bullet">      -</span> <span class="string">MYSQL_DATABASE=nextcloud</span></div><div class="line"><span class="bullet">      -</span> <span class="string">MYSQL_USER=nextcloud</span></div><div class="line"></div><div class="line"><span class="attr">  app:</span></div><div class="line"><span class="attr">    image:</span> <span class="string">nextcloud</span></div><div class="line"><span class="attr">    ports:</span></div><div class="line"><span class="bullet">      -</span> <span class="number">10080</span><span class="string">:80</span></div><div class="line"><span class="attr">    links:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">db</span></div><div class="line"><span class="attr">    volumes:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">/home/extspace/nextcloud/data:/var/www/html/data</span></div><div class="line"><span class="bullet">      -</span> <span class="string">/home/extspace/nextcloud/config:/var/www/config</span></div><div class="line"><span class="bullet">      -</span> <span class="string">/home/extspace/nextcloud/apps:/var/www/html/apps</span></div><div class="line"><span class="attr">    restart:</span> <span class="string">always</span></div><div class="line"><span class="attr">    environment:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">NEXTCLOUD_ADMIN_USER=admin</span></div><div class="line"><span class="bullet">      -</span> <span class="string">NEXTCLOUD_ADMIN_PASSWORD=admin</span></div></pre></td></tr></table></figure>
</li>
<li><p>拷贝<code>config</code>文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 用docker-compose启动</span></div><div class="line">sudo docker-compose up -d</div><div class="line"><span class="comment"># 使用bash方式进入某个具体的容器</span></div><div class="line">sudo docker <span class="built_in">exec</span> -ti nextcloud_app_1 /bin/bash</div><div class="line"><span class="comment"># 拷贝config</span></div><div class="line">cp -R /var/www/html/config/* /var/www/config</div><div class="line"></div><div class="line"><span class="comment"># config文件夹中包含以下五个文件</span></div><div class="line"><span class="comment"># apache-pretty-urls.config.php  apps.config.php  config.sample.php</span></div><div class="line"><span class="comment"># apcu.config.php                autoconfig.php</span></div><div class="line"></div><div class="line"><span class="comment"># 修改docker-compose.yml文件</span></div><div class="line">- /home/extspace/nextcloud/config:/var/www/html/config</div><div class="line"><span class="comment"># 再次启动配置文件 </span></div><div class="line">sudo docker-compose up -d</div></pre></td></tr></table></figure>
</li>
<li><p>浏览器访问<code>lab2:10080</code>进行初始化设置，数据库名字一定要输入<code>db</code>。</p>
</li>
</ul>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><ul>
<li><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt install nginx</div><div class="line"><span class="built_in">cd</span> /etc/nginx/sites-available</div><div class="line">sudo cp default yun.shyun.tk</div></pre></td></tr></table></figure>
</li>
<li><p><code>/etc/nginx/proxy.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/proxy.conf</div><div class="line"></div><div class="line"><span class="comment"># 文件内容如下</span></div><div class="line">proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">proxy_set_header Host <span class="variable">$http_host</span>;</div><div class="line">proxy_set_header X-NginX-Proxy <span class="literal">true</span>;</div><div class="line"></div><div class="line">proxy_redirect off;</div><div class="line"></div><div class="line"><span class="comment"># Socket.IO Support</span></div><div class="line">proxy_http_version 1.1;</div><div class="line">proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</div><div class="line">proxy_set_header Connection <span class="string">"upgrade"</span>;</div></pre></td></tr></table></figure>
</li>
<li><p><code>yun.shyun.tk</code>配置文件如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment"># You should look at the following URL's in order to grasp a solid understanding</span></div><div class="line"><span class="comment"># of Nginx configuration files in order to fully unleash the power of Nginx.</span></div><div class="line"><span class="comment"># http://wiki.nginx.org/Pitfalls</span></div><div class="line"><span class="comment"># http://wiki.nginx.org/QuickStart</span></div><div class="line"><span class="comment"># http://wiki.nginx.org/Configuration</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Generally, you will want to move this file somewhere, and start with a clean</span></div><div class="line"><span class="comment"># file but keep this around for reference. Or just disable in sites-enabled.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</span></div><div class="line"><span class="comment">##</span></div><div class="line"></div><div class="line"><span class="comment"># Default server configuration</span></div><div class="line"><span class="comment">#</span></div><div class="line">server &#123;</div><div class="line">	listen 80 ;</div><div class="line">	listen [::]:80 ;</div><div class="line"></div><div class="line">	<span class="comment"># SSL configuration</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment"># listen 443 ssl default_server;</span></div><div class="line">	<span class="comment"># listen [::]:443 ssl default_server;</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment"># Note: You should disable gzip for SSL traffic.</span></div><div class="line">	<span class="comment"># See: https://bugs.debian.org/773332</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment"># Read up on ssl_ciphers to ensure a secure configuration.</span></div><div class="line">	<span class="comment"># See: https://bugs.debian.org/765782</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment"># Self signed certs generated by the ssl-cert package</span></div><div class="line">	<span class="comment"># Don't use them in a production server!</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment"># include snippets/snakeoil.conf;</span></div><div class="line"></div><div class="line">	root /var/www/html;</div><div class="line"></div><div class="line">	<span class="comment"># Add index.php to the list if you are using PHP</span></div><div class="line">	index index.html index.htm index.nginx-debian.html index.php;</div><div class="line"></div><div class="line">	server_name yun.shyun.tk;</div><div class="line"></div><div class="line">	location / &#123;</div><div class="line">		<span class="comment"># First attempt to serve request as file, then</span></div><div class="line">		<span class="comment"># as directory, then fall back to displaying a 404.</span></div><div class="line">		try_files <span class="variable">$uri</span> @apache;</div><div class="line">	&#125;</div><div class="line">    </div><div class="line">	location @apache &#123;</div><div class="line">		internal;</div><div class="line">		proxy_pass http://127.0.0.1:10080;</div><div class="line">		include proxy.conf;</div><div class="line">    &#125;</div><div class="line">	<span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment">#location ~ \.php$ &#123;</span></div><div class="line">	<span class="comment">#	include snippets/fastcgi-php.conf;</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment">#	# With php7.0-cgi alone:</span></div><div class="line">	<span class="comment">#	fastcgi_pass 127.0.0.1:9000;</span></div><div class="line">	<span class="comment">#	# With php7.0-fpm:</span></div><div class="line">	<span class="comment">#	fastcgi_pass unix:/run/php/php7.0-fpm.sock;</span></div><div class="line">	<span class="comment">#&#125;</span></div><div class="line"></div><div class="line">	<span class="comment"># deny access to .htaccess files, if Apache's document root</span></div><div class="line">	<span class="comment"># concurs with nginx's one</span></div><div class="line">	<span class="comment">#</span></div><div class="line">	<span class="comment">#location ~ /\.ht &#123;</span></div><div class="line">	<span class="comment">#	deny all;</span></div><div class="line">	<span class="comment">#&#125;</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># Virtual Host configuration for example.com</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You can move that to a different file under sites-available/ and symlink that</span></div><div class="line"><span class="comment"># to sites-enabled/ to enable it.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#server &#123;</span></div><div class="line"><span class="comment">#	listen 80;</span></div><div class="line"><span class="comment">#	listen [::]:80;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#	server_name example.com;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#	root /var/www/example.com;</span></div><div class="line"><span class="comment">#	index index.html;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#	location / &#123;</span></div><div class="line"><span class="comment">#		try_files $uri $uri/ =404;</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#&#125;</span></div></pre></td></tr></table></figure>
</li>
<li><p>进入<code>sites-enabled</code>建立软连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/nginx/sites-enabled </div><div class="line">ln -s ../sites-availables/yun.shyun.tk</div></pre></td></tr></table></figure>
</li>
<li><p>未完待续</p>
</li>
</ul>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextcloud/">nextcloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">24</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/p/35840844.html"><i class="icon icon-arror-left"></i></a></li><li><a href="/p/10ed7470.html"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 Mr Wang's blog<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>